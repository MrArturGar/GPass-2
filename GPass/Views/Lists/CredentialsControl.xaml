<?xml version="1.0" encoding="utf-8"?>
<UserControl
    x:Class="GPass.Views.Elements.CredentialsControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
    xmlns:models="using:GPass.Models" 
    xmlns:elements="using:GPass.Views.Elements" 
    xmlns:helper="using:GPass.Resources"
    x:Name="ControlRoot"
    PointerEntered="ButtonAdd_PointerEntered"
    PointerExited="ButtonAdd_PointerExited">

    <UserControl.Resources>
        <DataTemplate x:Key="CredTitleTemplate" x:DataType="models:CredTitle">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <TextBox Text="{x:Bind Title, Mode=TwoWay}"
             Margin="5 0 5 10"
             FontSize="18"
             FontWeight="ExtraBold"
             BorderBrush="Transparent"
             Background="Transparent"
             IsReadOnly="True">
                    <TextBox.Resources>
                        <Style TargetType="TextBox">
                            <Setter Property="FocusVisualPrimaryBrush" Value="Transparent"/>
                            <Setter Property="FocusVisualSecondaryBrush" Value="Transparent"/>
                            <Setter Property="BorderThickness" Value="0"/>
                        </Style>
                    </TextBox.Resources>
                </TextBox>
                <StackPanel Orientation="Horizontal"
                Grid.Column="1"
                VerticalAlignment="Center"
                HorizontalAlignment="Right"
                Spacing="5"
                Visibility="{Binding IsEditing, ElementName=ControlRoot, Converter={StaticResource BooleanToVisibilityConverter}}" >
                    <TextBlock Text="⬍" Padding="0" Height="20" Width="10" />
                    <Button Content="×" x:Name="ButtonDelete" Padding="0" Height="25" Width="25"
                        Command="{Binding DataContext.CredentialViewModel.DeleteCredentialCommand, ElementName=ControlRoot}"
                        CommandParameter="{Binding}" />
                </StackPanel>
            </Grid>
        </DataTemplate>

        <DataTemplate x:Key="CredSecretFieldTemplate" x:DataType="models:CredSecretField">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <PasswordBox Password="{x:Bind SecretField, Mode=TwoWay}" 
                         Margin="5 0 5 0"
                         IsEnabled="False" 
                         Grid.Column="0" />
                <StackPanel Orientation="Horizontal"
                Grid.Column="1"
                VerticalAlignment="Center"
                HorizontalAlignment="Right"
                Spacing="5"
                Visibility="{Binding IsEditing, ElementName=ControlRoot, Converter={StaticResource BooleanToVisibilityConverter}}" >
                    <TextBlock Text="⬍" Padding="0" Height="20" Width="10" />
                    <Button Content="×" x:Name="ButtonDelete" Padding="0" Height="25" Width="25"
                        Command="{Binding DataContext.CredentialViewModel.DeleteCredentialCommand, ElementName=ControlRoot}"
                        CommandParameter="{Binding}" />
                </StackPanel>
            </Grid>
        </DataTemplate>

        <DataTemplate x:Key="CredFieldTemplate" x:DataType="models:CredField">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <TextBox Text="{x:Bind Field, Mode=TwoWay}" 
                         Margin="5 0 5 0"
                         Grid.Column="0" />
                <StackPanel Orientation="Horizontal"
                Grid.Column="1"
                VerticalAlignment="Center"
                HorizontalAlignment="Right"
                Spacing="5"
                Visibility="{Binding IsEditing, ElementName=ControlRoot, Converter={StaticResource BooleanToVisibilityConverter}}" >
                    <TextBlock Text="⬍" Padding="0" Height="20" Width="10" />
                    <Button Content="×" x:Name="ButtonDelete" Padding="0" Height="25" Width="25"
                        Command="{Binding DataContext.CredentialViewModel.DeleteCredentialCommand, ElementName=ControlRoot}"
                        CommandParameter="{Binding}" />
                </StackPanel>
            </Grid>
        </DataTemplate>

        <DataTemplate x:Key="CredLineTemplate" x:DataType="models:CredLine">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <Rectangle Height="5" Fill="Gray" Margin="5,10"
                         Grid.Column="0" />
                <StackPanel Orientation="Horizontal"
                Grid.Column="1"
                VerticalAlignment="Center"
                HorizontalAlignment="Right"
                Spacing="5"
                Visibility="{Binding IsEditing, ElementName=ControlRoot, Converter={StaticResource BooleanToVisibilityConverter}}" >
                    <TextBlock Text="⬍" Padding="0" Height="20" Width="10" />
                    <Button Content="×" x:Name="ButtonDelete" Padding="0" Height="25" Width="25"
                        Command="{Binding DataContext.CredentialViewModel.DeleteCredentialCommand, ElementName=ControlRoot}"
                        CommandParameter="{Binding}" />
                </StackPanel>
            </Grid>
        </DataTemplate>

        <DataTemplate x:Key="DefaultTemplate">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <Border Background="Red" Padding="10"
                         Grid.Column="0" >
                    <TextBlock Text="Error" Foreground="White"/>
                </Border>
                <StackPanel Orientation="Horizontal"
                Grid.Column="1"
                VerticalAlignment="Center"
                HorizontalAlignment="Right"
                Spacing="5"
                Visibility="{Binding IsEditing, ElementName=ControlRoot, Converter={StaticResource BooleanToVisibilityConverter}}" >
                    <TextBlock Text="⬍" Padding="0" Height="20" Width="10" />
                    <Button Content="×" x:Name="ButtonDelete" Padding="0" Height="25" Width="25"
                        Command="{Binding DataContext.CredentialViewModel.DeleteCredentialCommand, ElementName=ControlRoot}"
                        CommandParameter="{Binding}" />
                </StackPanel>
            </Grid>
        </DataTemplate>

        <helper:CredentialTemplateSelector x:Key="CredentialSelector"
            CredTitleTemplate="{StaticResource CredTitleTemplate}"
            CredSecretFieldTemplate="{StaticResource CredSecretFieldTemplate}"
            CredFieldTemplate="{StaticResource CredFieldTemplate}"
            CredLineTemplate="{StaticResource CredLineTemplate}"/>
    </UserControl.Resources>

    <Grid Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <ListView x:Name="NameList" 
         ItemsSource="{x:Bind ItemsSource, Mode=OneWay}" 
         AllowDrop="True"
         CanReorderItems="{x:Bind IsEditing, Mode=OneWay}"
         ReorderMode="Enabled"
         ItemTemplateSelector="{StaticResource CredentialSelector}"
         SelectionMode="None"
         DragItemsCompleted="NameList_DragItemsCompleted" >

            <ListView.ItemContainerStyle>
                <Style TargetType="ListBoxItem">
                    <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                    <Setter Property="Margin" Value="0,5"/>
                </Style>
            </ListView.ItemContainerStyle>
        </ListView>

        <StackPanel Orientation="Horizontal" Grid.Row="1" HorizontalAlignment="Center" VerticalAlignment="Bottom" Padding="30 10" Height="50" >
            <Button x:Name="ButtonAdd" Content="Add" Visibility="Collapsed" Margin="0 0 5 0">
                <Button.Flyout>
                    <MenuFlyout>
                        <MenuFlyoutItem Text="Add Title" 
                Command="{x:Bind AddCommand}" 
                CommandParameter="CredTitle"/>
                        <MenuFlyoutItem Text="Add Field" 
                Command="{x:Bind AddCommand}" 
                CommandParameter="CredField"/>
                        <MenuFlyoutItem Text="Add Secret" 
                Command="{x:Bind AddCommand}" 
                CommandParameter="CredSecretField"/>
                        <MenuFlyoutItem Text="Add Line" 
                Command="{x:Bind AddCommand}" 
                CommandParameter="CredLine"/>
                    </MenuFlyout>
                </Button.Flyout>
            </Button>
            <Button x:Name="ButtonEdit" 
            Content="{x:Bind IsEditing, Converter={StaticResource EditButtonContentConverter}, Mode=OneWay}" 
            Command="{x:Bind ToggleEditCommand}" 
            Visibility="Collapsed" />
        </StackPanel>
    </Grid>
</UserControl>
